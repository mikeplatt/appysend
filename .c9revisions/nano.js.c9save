{"ts":1367930427360,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1367930390531,"patch":[[{"diffs":[[1,"var nano = require('nano')('https://appy:snatch123@appy.cloudant.com/');\n\nvar email = require('./email.js'),\n    facebook = require(\"./facebook.js\"),\n    mms = require(\"./mms.js\"),\n    cards = require('./cards.js');\n\n// couchDB\nvar sentDB = nano.db.use('sent');\n\nfunction handleError (err) {\n    console.log(err);\n}\n\nfunction handleSaveResponse(res) {\n    console.log(res);\n}\n\nfunction handleQueryResponse(doc) {\n    \n    var thisCard = cards.new(doc._id, doc._rev, doc.userID, doc.state, doc.where, doc.name, doc.address, doc.token);\n    \n    if(doc.where == 'facebook') {\n        \n        console.log('HIT FACEBOOK');\n        \n        facebook.createWallPost(thisCard);\n        \n    } else if(doc.where == 'MMS') {\n        \n        console.log('HIT MMS');\n        \n        mms.createMMS(thisCard);\n        \n    } else {\n        \n        console.log('HIT EMAIL');\n        \n        email.createEmail(thisCard);\n    }\n}\n\n    \nexports.createQuery = function() {\n    \n    console.log('HIT QUERY');\n    \n    var startDate = new Date();\n    \n    startDate.setHours('00'); startDate.setMinutes('00'); startDate.setSeconds('00');\n    \n    var startJSON = startDate.toJSON();\n    \n    var endDate = new Date();\n    \n    endDate.setHours('23'); endDate.setMinutes('59'); endDate.setSeconds('59');\n\n    var endJSON = endDate.toJSON();\n    \n    sentDB.view('state', 'pending', { endkey : endJSON }, function(err, res) {\n        \n        if (err) {\n            \n            handleError(err);\n            \n        } else {\n            \n            res.rows.forEach(function(doc) {\n                \n                handleQueryResponse(doc.value);\n                \n            });\n        }\n    });\n};\n\nexports.handleSent = function (thisCard) {\n    \n    sentDB.atomic('state', 'sent', thisCard.docID, {}, function(err, res) {\n\n        if (err) \n            handleError(err);\n        else \n            handleSaveResponse(res);\n            \n    });\n};\n\nexports.handleFail = function (thisCard) {\n    \n    sentDB.atomic('state', 'returned', thisCard.docID, {}, function(err, res) {\n\n        if (err) \n            handleError(err);\n        else \n            handleSaveResponse(res);\n            \n    });\n};\n\n\n"]],"start1":0,"start2":0,"length1":0,"length2":2191}]],"length":2191,"saved":false}
{"contributors":[],"silentsave":false,"ts":1367937186278,"patch":[[{"diffs":[[0,"   \n"],[-1,"        console.log('HIT FACEBOOK');\n        \n"],[0,"    "]],"start1":579,"start2":579,"length1":54,"length2":8},{"diffs":[[0,"Post(thisCard);\n"],[1,""],[0,"        \n    } e"]],"start1":610,"start2":610,"length1":32,"length2":32},{"diffs":[[0,"   \n"],[-1,"        console.log('HIT MMS');\n        \n"],[0,"    "]],"start1":676,"start2":676,"length1":49,"length2":8},{"diffs":[[0,"   \n"],[-1,"        console.log('HIT EMAIL');\n        \n"],[0,"    "]],"start1":740,"start2":740,"length1":51,"length2":8},{"diffs":[[0,"}\n\n    \n"],[1,""],[0,"exports."]],"start1":787,"start2":787,"length1":16,"length2":16},{"diffs":[[0,"   \n"],[-1,"    console.log('HIT QUERY');\n    \n"],[0,"    "]],"start1":831,"start2":831,"length1":43,"length2":8}]],"length":2026,"saved":false}
